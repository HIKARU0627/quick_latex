% university-style.sty
% 大学レポート・論文用の共通スタイルファイル
% 作成日: 2024
% 使用方法: \usepackage{../../../common/university-style}

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{university-style}[2024/01/01 University LaTeX Style Package]

% ==================================================
% パッケージオプション
% ==================================================
\newif\if@japanese\@japanesefalse
\newif\if@programming\@programmingfalse
\newif\if@experiment\@experimentfalse
\newif\if@thesis\@thesisfalse

\DeclareOption{japanese}{\@japanesetrue}
\DeclareOption{programming}{\@programmingtrue}
\DeclareOption{experiment}{\@experimenttrue}
\DeclareOption{thesis}{\@thesistrue}
\ProcessOptions\relax

% ==================================================
% 基本パッケージ
% ==================================================
\RequirePackage{amsmath,amssymb,amsthm}
\RequirePackage{graphicx}
\RequirePackage{xcolor}
\RequirePackage{hyperref}
\RequirePackage{booktabs}
\RequirePackage{float}

% 日本語設定
\if@japanese
    \RequirePackage{luatexja-fontspec}
\fi

% ==================================================
% 色の定義
% ==================================================
\definecolor{primaryblue}{RGB}{25, 102, 179}
\definecolor{secondaryblue}{RGB}{52, 152, 219}
\definecolor{accentorange}{RGB}{243, 156, 18}
\definecolor{accentgreen}{RGB}{39, 174, 96}
\definecolor{darkgray}{RGB}{52, 58, 64}
\definecolor{lightgray}{RGB}{248, 249, 250}

% コード用の色
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

% ==================================================
% ハイパーリンク設定
% ==================================================
\hypersetup{
    colorlinks=true,
    linkcolor=primaryblue,
    filecolor=magenta,
    urlcolor=primaryblue,
    citecolor=primaryblue,
    bookmarks=true,
    bookmarksnumbered=true,
    pdfpagemode=UseOutlines
}

% ==================================================
% 定理環境（日本語対応）
% ==================================================
\theoremstyle{definition}
\if@japanese
    \newtheorem{definition}{定義}[section]
    \newtheorem{theorem}{定理}[section]
    \newtheorem{lemma}{補題}[section]
    \newtheorem{corollary}{系}[section]
    \newtheorem{proposition}{命題}[section]
    \newtheorem{example}{例}[section]
\else
    \newtheorem{definition}{Definition}[section]
    \newtheorem{theorem}{Theorem}[section]
    \newtheorem{lemma}{Lemma}[section]
    \newtheorem{corollary}{Corollary}[section]
    \newtheorem{proposition}{Proposition}[section]
    \newtheorem{example}{Example}[section]
\fi

\theoremstyle{remark}
\if@japanese
    \newtheorem{remark}{注意}[section]
\else
    \newtheorem{remark}{Remark}[section]
\fi

% ==================================================
% プログラミング関連設定
% ==================================================
\if@programming
    \RequirePackage{listings}
    \RequirePackage{algorithm2e}
    
    % Python用設定
    \lstdefinestyle{python}{
        language=Python,
        backgroundcolor=\color{backcolour},   
        commentstyle=\color{codegreen},
        keywordstyle=\color{magenta},
        numberstyle=\tiny\color{codegray},
        stringstyle=\color{codepurple},
        basicstyle=\ttfamily\footnotesize,
        breakatwhitespace=false,         
        breaklines=true,                 
        captionpos=b,                    
        keepspaces=true,                 
        numbers=left,                    
        numbersep=5pt,                  
        showspaces=false,                
        showstringspaces=false,
        showtabs=false,                  
        tabsize=4
    }
    
    % Java用設定
    \lstdefinestyle{java}{
        language=Java,
        backgroundcolor=\color{backcolour},   
        commentstyle=\color{codegreen},
        keywordstyle=\color{blue},
        numberstyle=\tiny\color{codegray},
        stringstyle=\color{red},
        basicstyle=\ttfamily\footnotesize,
        breakatwhitespace=false,         
        breaklines=true,                 
        captionpos=b,                    
        keepspaces=true,                 
        numbers=left,                    
        numbersep=5pt,                  
        showspaces=false,                
        showstringspaces=false,
        showtabs=false,                  
        tabsize=4
    }
    
    % C/C++用設定
    \lstdefinestyle{cpp}{
        language=C++,
        backgroundcolor=\color{backcolour},   
        commentstyle=\color{codegreen},
        keywordstyle=\color{blue},
        numberstyle=\tiny\color{codegray},
        stringstyle=\color{red},
        basicstyle=\ttfamily\footnotesize,
        breakatwhitespace=false,         
        breaklines=true,                 
        captionpos=b,                    
        keepspaces=true,                 
        numbers=left,                    
        numbersep=5pt,                  
        showspaces=false,                
        showstringspaces=false,
        showtabs=false,                  
        tabsize=4
    }
    
    % デフォルトスタイル設定
    \lstset{style=python}
    
    % アルゴリズム設定（日本語対応）
    \SetAlgoLined
    \if@japanese
        \SetKwInOut{Input}{入力}
        \SetKwInOut{Output}{出力}
    \else
        \SetKwInOut{Input}{Input}
        \SetKwInOut{Output}{Output}
    \fi
\fi

% ==================================================
% 実験レポート関連設定
% ==================================================
\if@experiment
    \RequirePackage{siunitx}
    \RequirePackage{pgfplots}
    \RequirePackage{subcaption}
    \pgfplotsset{compat=1.16}
    
    % SI単位の設定
    \sisetup{
        output-decimal-marker = {.},
        group-separator = {,},
        per-mode = symbol
    }
    
    % 測定データ用のテーブルスタイル
    \newcolumntype{S}{S[table-format=3.2]}
    
    % 実験結果用のカスタムコマンド
    \newcommand{\measured}[3]{\SI{#1 \pm #2}{#3}}  % 測定値±誤差
    \newcommand{\theoretical}[2]{\SI{#1}{#2}}      % 理論値
\fi

% ==================================================
% 論文用設定
% ==================================================
\if@thesis
    \RequirePackage{fancyhdr}
    \RequirePackage{titlesec}
    \RequirePackage{tocloft}
    \RequirePackage{natbib}
    
    % ページスタイル設定
    \pagestyle{fancy}
    \fancyhf{}
    \fancyhead[LE]{\leftmark}
    \fancyhead[RO]{\rightmark}
    \fancyfoot[C]{\thepage}
    
    % 章の開始ページのスタイル
    \fancypagestyle{plain}{%
        \fancyhf{}
        \fancyfoot[C]{\thepage}
        \renewcommand{\headrulewidth}{0pt}
    }
    
    \if@japanese
        % 章・節のスタイル設定（日本語）
        \titleformat{\chapter}[display]
            {\normalfont\huge\bfseries}
            {第\thechapter 章}
            {10pt}
            {\Huge}
    \fi
    
    % 目次のスタイル
    \renewcommand{\cftchapfont}{\bfseries}
    \renewcommand{\cftsecfont}{\normalfont}
\fi

% ==================================================
% カスタムコマンド
% ==================================================
% 強調用コマンド
\newcommand{\highlight}[1]{\textcolor{accentorange}{\textbf{#1}}}
\newcommand{\important}[1]{\textcolor{red}{\textbf{#1}}}
\newcommand{\note}[1]{\textcolor{accentgreen}{\textit{#1}}}
\newcommand{\keyword}[1]{\textcolor{primaryblue}{\textbf{#1}}}
\newcommand{\technical}[1]{\textcolor{darkgray}{\texttt{#1}}}

% 日本語用の強調コマンド
\if@japanese
    \newcommand{\強調}[1]{\highlight{#1}}
    \newcommand{\重要}[1]{\important{#1}}
    \newcommand{\注意}[1]{\note{#1}}
    \newcommand{\キーワード}[1]{\keyword{#1}}
\fi

% 大学情報設定用コマンド
\newcommand{\@university}{}
\newcommand{\@department}{}
\newcommand{\@studentid}{}
\newcommand{\@supervisor}{}

\newcommand{\university}[1]{\renewcommand{\@university}{#1}}
\newcommand{\department}[1]{\renewcommand{\@department}{#1}}
\newcommand{\studentid}[1]{\renewcommand{\@studentid}{#1}}
\newcommand{\supervisor}[1]{\renewcommand{\@supervisor}{#1}}

% レポートヘッダー作成コマンド
\newcommand{\reportheader}{
    \begin{center}
        {\large \@university} \\
        {\large \@department} \\
        \vspace{0.5cm}
        {\Large \textbf{\@title}} \\
        \vspace{0.3cm}
        学籍番号: \@studentid \quad 氏名: \@author \\
        提出日: \@date
    \end{center}
    \vspace{1cm}
}

% ==================================================
% 環境定義
% ==================================================
% 問題・解答環境（シンプル版）
\if@japanese
    \newenvironment{problem}[1][問題]
    {\par\textbf{#1：}\par\vspace{0.5em}}
    {\par\vspace{0.5em}}
    
    \newenvironment{solution}[1][解答]
    {\par\textbf{#1：}\par\vspace{0.5em}}
    {\par\vspace{0.5em}}
\else
    \newenvironment{problem}[1][Problem]
    {\par\textbf{#1:}\par\vspace{0.5em}}
    {\par\vspace{0.5em}}
    
    \newenvironment{solution}[1][Solution]
    {\par\textbf{#1:}\par\vspace{0.5em}}
    {\par\vspace{0.5em}}
\fi

% ==================================================
% ページレイアウト調整
% ==================================================
% 日本語レポート用のマージン設定
\if@japanese
    \setlength{\textwidth}{16cm}
    \setlength{\textheight}{23cm}
    \setlength{\oddsidemargin}{0cm}
    \setlength{\evensidemargin}{0cm}
    \setlength{\topmargin}{-0.5cm}
\fi

% ==================================================
% デバッグ・開発支援
% ==================================================
% デバッグモード用コマンド
\newcommand{\TODO}[1]{\textcolor{red}{\textbf{TODO: #1}}}
\newcommand{\FIXME}[1]{\textcolor{orange}{\textbf{FIXME: #1}}}

% ==================================================
% 追加機能
% ==================================================

% 引用・参照の強化
\newcommand{\citeauthor}[1]{#1} % 著者名のみ引用
\newcommand{\citeyear}[1]{(#1年)} % 年のみ引用

% 数式環境の拡張
\if@japanese
    \newenvironment{proof}{{\textbf{証明：}}}{\hfill$\square$}
    \renewcommand{\qedsymbol}{$\square$}
\fi

% 図表の自動参照
\newcommand{\figref}[1]{図\ref{#1}}
\newcommand{\tabref}[1]{表\ref{#1}}
\newcommand{\eqref}[1]{式(\ref{#1})}
\newcommand{\secref}[1]{第\ref{#1}節}
\newcommand{\chapref}[1]{第\ref{#1}章}

% 英語版の参照コマンド
\newcommand{\figrefeng}[1]{Figure \ref{#1}}
\newcommand{\tabrefeng}[1]{Table \ref{#1}}
\newcommand{\secrefeng}[1]{Section \ref{#1}}
\newcommand{\chaprefeng}[1]{Chapter \ref{#1}}

% 単位・記号の一貫性確保
\newcommand{\unit}[1]{\,\mathrm{#1}}
\newcommand{\celsius}{\unit{{}^\circ C}}
\newcommand{\percent}{\unit{\%}}

% レビュー・コメント機能
\RequirePackage{xifthen}
\newboolean{showcomments}
\setboolean{showcomments}{false} % デフォルトは非表示

\newcommand{\comment}[2][]{%
    \ifthenelse{\boolean{showcomments}}{%
        \textcolor{red}{\textbf{[#1: #2]}}%
    }{}%
}

\newcommand{\showcomments}{\setboolean{showcomments}{true}}
\newcommand{\hidecomments}{\setboolean{showcomments}{false}}

% 脚注の強化
\newcommand{\footnoteurl}[1]{\footnote{\url{#1}}}
\newcommand{\footnotecite}[2]{\footnote{#1, #2}}

% カスタム環境の追加
\if@japanese
    % よくある質問環境
    \newenvironment{faq}[1]
    {\par\textbf{Q: #1}\par\vspace{0.2em}\textbf{A: }}
    {\par\vspace{0.5em}}
    
    % 学習目標環境
    \newenvironment{objectives}
    {\par\textbf{学習目標：}\par\begin{itemize}}
    {\end{itemize}\par\vspace{0.5em}}
    
    % 重要ポイント環境
    \newenvironment{keypoints}
    {\par\textcolor{primaryblue}{\textbf{重要ポイント：}}\par\begin{itemize}}
    {\end{itemize}\par\vspace{0.5em}}
\fi

% 多言語対応の強化
\if@japanese
    \newcommand{\abstractname}{概要}
    \newcommand{\keywordsname}{キーワード}
    \newcommand{\appendixname}{付録}
    \newcommand{\contentsname}{目次}
    \newcommand{\referencesname}{参考文献}
\fi

\endinput